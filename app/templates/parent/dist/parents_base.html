<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}CBC-EDU Triad Parent Dashboard{% endblock %}</title>

    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Google Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/student_base.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/colors.css') }}">   
    {% block styles %}{% endblock %}
    <!-- Custom JS -->
    <script src="{{ url_for('static', filename='js/student_base.js') }}" defer></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const childSelectors = document.querySelectorAll('.child-select');
            
            // Function to handle child selection changes
            function handleChildSelection(selectedChildId) {
                if (selectedChildId) {
                    childSelectors.forEach(s => {
                        s.value = selectedChildId;
                    });
                    sessionStorage.setItem('selectedChildId', selectedChildId);
                    
                    // Update the URL with the child_id parameter
                    const currentUrl = new URL(window.location.href);
                    currentUrl.searchParams.set('child_id', selectedChildId);
                    window.history.replaceState({}, '', currentUrl);
                }
            }
    
            // Initialize from URL or session storage
            const urlParams = new URLSearchParams(window.location.search);
            const childIdFromUrl = urlParams.get('child_id');
            const storedChildId = sessionStorage.getItem('selectedChildId');
            
            if (childIdFromUrl || storedChildId) {
                const childIdToSelect = childIdFromUrl || storedChildId;
                handleChildSelection(childIdToSelect);
            }
    
            // Add event listeners to all child selectors
            childSelectors.forEach(select => {
                select.addEventListener('change', function() {
                    handleChildSelection(this.value);
                    
                    // Refresh the page to load new child's data
                    window.location.href = `{{ url_for('parent.parent_projects') }}?child_id=${this.value}`;
                });
            });
        });
    </script>
</head>
<body>
    <!-- Sidebar -->
    <aside class="dashboard-sidebar" id="sidebar">
        <button id="close-btn" aria-label="Close">&times;</button>
        <div class="sidebar-header">
            <h2>Dashboard</h2>
        </div>

        <!-- Child Selection in Sidebar -->
        <div class="sidebar-child-selector">
            <select class="child-select">
                <option value="">-- Select Child --</option>
                {% for child in children %}
                <option value="{{ child[0] }}" 
                    {% if selected_child and child[0] == selected_child[0] %}selected{% endif %} 
                    style="color: blue;">
                    {{ child[1] }} {{ child[2] }}
                </option>
                {% endfor %}
            </select>
        </div>

        <nav>
            <a href="{{ url_for('parent.parents_dashboard') }}" class="sidebar-link {% if request.endpoint == 'parent.parents_dashboard' %}active{% endif %}">
                <i class="fas fa-chart-pie"></i> Child's Progress
            </a>
            <a href="{{ url_for('parent.competency_overview') }}" class="sidebar-link {% if request.endpoint == 'parent.competency_overview' %}active{% endif %}">
                <i class="fas fa-chart-bar"></i> Competency Overview
            </a>
            <a href="{{ url_for('parent.parent_profile') }}" class="sidebar-link {% if request.endpoint == 'parent.parent_profile' %}active{% endif %}">
                <i class="fas fa-user"></i> Profile
            </a>
           

            <a href="{{ url_for('parent.parent_projects', child_id=selected_child[0] if selected_child else '') }}" 
            class="sidebar-link {% if request.endpoint == 'parent.parent_projects' %}active{% endif %}">
             <i class="fas fa-folder"></i> Projects
         </a>

            <a href="{{ url_for('parent.parent_feedback') }}" class="sidebar-link {% if request.endpoint == 'parent.parent_feedback' %}active{% endif %}">
                <i class="fas fa-comment"></i> Feedback
            </a>
            <a href="{{ url_for('parent.parent_reports') }}" class="sidebar-link {% if request.endpoint == 'parent.parent_reports' %}active{% endif %}">
                <i class="fas fa-file-alt"></i> Reports
            </a>
            <a href="{{ url_for('parent.parent_notifications') }}" class="sidebar-link {% if request.endpoint == 'parent.parent_notifications' %}active{% endif %}">
                <i class="fas fa-bell"></i> Notifications
            </a>
            <a href="{{ url_for('parent.parent_settings') }}" class="sidebar-link {% if request.endpoint == 'parent.parent_settings' %}active{% endif %}">
                <i class="fas fa-cog"></i> Settings
            </a>
        </nav>
    </aside>

    <!-- Header -->
    <header class="dashboard-header">
        <button class="Hamburger-menu-btn" id="Hamburger-menu-btn" aria-label="Menu">&#8942;&#8942;&#8942;</button>
         <h1>Parent:{{ session.get('parent_name', 'Parent') }}</h1>
        <a href="{{ url_for('auth.parent_logout') }}" class="btn-logout"><i class="fas fa-sign-out-alt"></i> Logout</a> 
        <div class="child-selector">
            <select class="child-select">
                <option value="">-- Select Child --</option>
                {% for child in children %}
                <option value="{{ child[0] }}"
                    {% if selected_child and child[0] == selected_child[0] %}selected{% endif %} 
                    >
                    {{ child[1] }} {{ child[2] }}
                </option>
                {% endfor %}
            </select>
        </div>
    </header>

    <!-- Main Content -->
    <main class="dashboard-content">
        <h1>Welcome, {{ session.get('parent_name', 'Parent') }}</h1>
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages">
                    {% for category, message in messages %}
                        <div class="flash {{ category }}">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}
        
        {% block content %}{% endblock %}
    </main>

</body>
</html>
